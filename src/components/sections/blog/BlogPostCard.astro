---
// Third-party
import { Icon } from "astro-icon/components";
import type { CollectionEntry } from "astro:content";

// Utils
import { formatDateLong } from "../../../utils/date";
import { createUrl } from "../../../utils/url";

interface Props {
  post: CollectionEntry<"blog"> & { readTime?: number };
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const slug = post.id.replace(/\.mdx?$/, "");

// Check if post is new (published in last 7 days)
const isNewPost =
  post.data.publishDate &&
  Date.now() - post.data.publishDate.getTime() < 7 * 24 * 60 * 60 * 1000;
---

{
  featured ? (
    <div class="max-w-6xl mx-auto mb-6">
      <a
        href={createUrl(`blog/${slug}`)}
        class="group block bg-gradient-to-br from-card to-card/80 border-2 border-accent-green/30 rounded-2xl overflow-hidden hover:border-accent-green transition-all duration-normal"
        aria-label={`Read ${post.data.title}`}
      >
        <div class="p-8 md:p-12">
          <!-- Icon at top center -->
          <div class="flex justify-center mb-6">
            <Icon
              name="mdi:post"
              class="w-16 h-16 text-accent-green transition-colors"
            />
          </div>

          <!-- Badges -->
          <div class="flex flex-wrap items-center justify-center gap-2 mb-4">
            <div class="inline-flex items-center gap-1.5 px-3 py-1 bg-accent-green text-xs font-bold rounded-full transition-colors">
              <Icon name="mdi:star" class="w-3 h-3" />
              FEATURED
            </div>
            {isNewPost && (
              <div class="inline-flex items-center gap-1.5 px-3 py-1 bg-accent-green/20 border border-accent-green/40 text-accent-green text-xs font-semibold rounded-full transition-colors">
                NEW
              </div>
            )}
          </div>

          <!-- Title -->
          <h2 class="text-2xl md:text-3xl font-bold mb-4 text-center group-hover:text-accent-green transition-colors text-primary">
            {post.data.title}
          </h2>

          <!-- Description -->
          <p class="text-secondary mb-6 text-center transition-colors">
            {post.data.description}
          </p>

          <!-- Metadata -->
          <div class="flex flex-wrap items-center justify-center gap-2 text-sm text-tertiary transition-colors">
            <div class="flex items-center gap-1.5">
              <Icon name="mdi:calendar" class="w-4 h-4 text-accent-green" />
              <span>{formatDateLong(post.data.publishDate)}</span>
            </div>
            <span>•</span>
            <div class="flex items-center gap-1.5">
              <Icon name="mdi:account" class="w-4 h-4 text-accent-green" />
              <span>{post.data.author}</span>
            </div>
            {post.readTime && post.readTime > 0 && (
              <>
                <span>•</span>
                <div class="flex items-center gap-1.5">
                  <Icon name="mdi:clock" class="w-4 h-4 text-accent-green" />
                  <span>{post.readTime} min read</span>
                </div>
              </>
            )}
          </div>
        </div>
      </a>
    </div>
  ) : (
    <a
      href={createUrl(`blog/${slug}`)}
      class="group bg-card border-2 border-accent-green/30 rounded-xl overflow-hidden hover:border-accent-green transition-all duration-normal hover:-translate-y-1 flex flex-col h-full"
      aria-label={`Read ${post.data.title}`}
    >
      <div class="p-6 flex flex-col flex-grow">
        <!-- Icon at top center -->
        <div class="flex justify-center mb-4 h-12">
          <Icon
            name="mdi:post"
            class="w-12 h-12 text-accent-green transition-colors"
          />
        </div>

        <!-- Badges - Fixed height container -->
        <div class="min-h-[24px] mb-3">
          {isNewPost && (
            <div class="flex flex-wrap items-center justify-center gap-2">
              <div class="inline-flex items-center gap-1 px-2 py-1 bg-accent-green/20 border border-accent-green/40 text-accent-green text-xs font-semibold rounded-full">
                NEW
              </div>
            </div>
          )}
        </div>

        <!-- Title - Fixed min height for alignment -->
        <h3 class="text-lg font-bold mb-3 text-center group-hover:text-accent-green transition-colors text-primary leading-tight min-h-[3.5rem] flex items-center justify-center">
          {post.data.title}
        </h3>

        <!-- Description - Always exactly 2 lines with ellipsis -->
        <p class="text-sm text-secondary mb-4 text-center line-clamp-2 transition-colors flex-grow overflow-hidden" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.375rem; min-height: 2.75rem; max-height: 2.75rem;">
          {post.data.description}
        </p>

        <!-- Metadata - Aligned at bottom -->
        <div class="flex flex-wrap items-center justify-center gap-2 text-xs text-tertiary transition-colors mt-auto">
          <div class="flex items-center gap-1">
            <Icon name="mdi:calendar" class="w-3.5 h-3.5 text-accent-green flex-shrink-0" />
            <span>{formatDateLong(post.data.publishDate)}</span>
          </div>
          <span>•</span>
          <div class="flex items-center gap-1">
            <Icon name="mdi:account" class="w-3.5 h-3.5 text-accent-green flex-shrink-0" />
            <span>{post.data.author}</span>
          </div>
          {post.readTime && post.readTime > 0 && (
            <>
              <span>•</span>
              <div class="flex items-center gap-1">
                <Icon name="mdi:clock" class="w-3.5 h-3.5 text-accent-green flex-shrink-0" />
                <span>{post.readTime} min</span>
              </div>
            </>
          )}
        </div>
      </div>
    </a>
  )
}
