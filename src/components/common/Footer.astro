---
import { siteData } from "../../data/config/site";
import { Icon } from "astro-icon/components";
import Logo from "./Logo.astro";
import { getBaseUrl, createUrl } from "../../utils/url";

interface Props {
  hideNewsletter?: boolean;
}

const { hideNewsletter = false } = Astro.props;
const base = getBaseUrl();
const currentYear = new Date().getFullYear();

const legalLinks = [
  { href: createUrl('legal/privacy-policy'), label: "Privacy Policy" },
  { href: createUrl('legal/terms'), label: "Terms of Service" },
  { href: createUrl('legal/cookie-policy'), label: "Cookie Policy" },
];
---

<footer
  class="bg-card border-t-2 border-theme relative z-10 transition-colors duration-300"
>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-12 lg:py-16">
    <!-- Main Footer Content -->
    <div class="grid gap-4 sm:gap-8 lg:gap-10 lg:grid-cols-12 mb-1 sm:mb-8 lg:mb-10">
      <!-- Mobile: Compact layout - Logo + Social in one row, Contact + Links below -->
      <div class="sm:hidden space-y-3">
        <!-- Logo + Social Row -->
        <div class="flex items-center justify-between">
          <Logo size="sm" showText={true} href={base} />
          <!-- Social Links - Compact -->
          <div class="flex gap-2">
            <a
              href={siteData.social.linkedin}
              class="w-10 h-10 bg-accent-green/10 hover:bg-accent-green/20 border border-accent-green/30 hover:border-accent-green rounded-lg flex items-center justify-center text-accent-green active:scale-95 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent-green/50 min-w-[40px] min-h-[40px]"
              aria-label="Follow AUXO Data Labs on LinkedIn"
              target="_blank"
              rel="noopener noreferrer"
            >
              <Icon name="mdi:linkedin" class="w-5 h-5" />
            </a>
            <a
              href={siteData.social.twitter}
              class="w-10 h-10 bg-accent-green/10 hover:bg-accent-green/20 border border-accent-green/30 hover:border-accent-green rounded-lg flex items-center justify-center text-accent-green active:scale-95 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent-green/50 min-w-[40px] min-h-[40px]"
              aria-label="Follow AUXO Data Labs on Twitter"
              target="_blank"
              rel="noopener noreferrer"
            >
              <Icon name="mdi:twitter" class="w-5 h-5" />
            </a>
          </div>
        </div>
        
        <!-- Contact - Compact -->
        <a
          href={`mailto:${siteData.email}?subject=Inquiry from AUXO Website`}
          class="flex items-center justify-center gap-2 group"
        >
          <Icon name="mdi:email" class="w-5 h-5 text-accent-green" />
          <span class="text-sm font-medium text-primary group-hover:text-accent-green transition-colors" style="font-family: var(--font-body);">
            Contact Us
          </span>
        </a>
      </div>

      <!-- Desktop: Brand Section (Full) -->
      <section class="hidden sm:block lg:col-span-5 space-y-4 sm:space-y-6">
        <!-- Logo and Brand Name - Desktop: Left-aligned -->
        <Logo size="lg" showText={true} href={base} class="items-start" />

        <!-- Email Contact - Desktop: Full -->
        <div class="space-y-4">
          <!-- Email - Desktop: Full -->
          <a
            href={`mailto:${siteData.email}?subject=Inquiry from AUXO Website`}
            class="flex items-center gap-3 group"
          >
            <div class="w-12 h-12 bg-accent-green/15 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:bg-accent-green/25 transition-colors">
              <Icon name="mdi:email" class="w-6 h-6 text-accent-green" />
            </div>
            <div class="flex-1 min-w-0">
              <div class="text-base font-semibold text-primary break-all group-hover:text-accent-green transition-colors" style="font-family: var(--font-body);">
                {siteData.email}
              </div>
              <div class="flex items-center gap-2 mt-1">
                <Icon name="mdi:clock-outline" class="w-3.5 h-3.5 text-secondary" />
                <span class="text-xs text-secondary" style="font-family: var(--font-body);">
                  Response within <span class="font-medium text-accent-green">24 hours</span>
                </span>
              </div>
            </div>
          </a>

          <!-- Location -->
          <div class="flex items-center gap-3 text-secondary">
            <div class="w-12 h-12 bg-accent-green/15 rounded-xl flex items-center justify-center flex-shrink-0">
              <Icon name="mdi:map-marker" class="w-6 h-6 text-accent-green" />
            </div>
            <span class="text-base" style="font-family: var(--font-body);">
              {siteData.address.city}, {siteData.address.country}
            </span>
          </div>
        </div>

        <!-- Social Links - Desktop: Left -->
        <div class="pt-2">
          <p class="text-xs font-semibold text-secondary uppercase tracking-wider mb-4" style="font-family: var(--font-body);">
            Follow Us
          </p>
          <div class="flex gap-4">
            <a
              href={siteData.social.linkedin}
              class="group relative w-14 h-14 lg:w-16 lg:h-16 bg-accent-green/10 hover:bg-accent-green/20 border border-accent-green/30 hover:border-accent-green rounded-xl flex items-center justify-center text-accent-green active:scale-95 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent-green/50 min-w-[56px] min-h-[56px] lg:min-w-[64px] lg:min-h-[64px]"
              aria-label="Follow AUXO Data Labs on LinkedIn"
              target="_blank"
              rel="noopener noreferrer"
            >
              <Icon
                name="mdi:linkedin"
                class="w-7 h-7 lg:w-8 lg:h-8 group-hover:scale-110 transition-transform"
              />
            </a>
            <a
              href={siteData.social.twitter}
              class="group relative w-14 h-14 lg:w-16 lg:h-16 bg-accent-green/10 hover:bg-accent-green/20 border border-accent-green/30 hover:border-accent-green rounded-xl flex items-center justify-center text-accent-green active:scale-95 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent-green/50 min-w-[56px] min-h-[56px] lg:min-w-[64px] lg:min-h-[64px]"
              aria-label="Follow AUXO Data Labs on Twitter"
              target="_blank"
              rel="noopener noreferrer"
            >
              <Icon
                name="mdi:twitter"
                class="w-7 h-7 lg:w-8 lg:h-8 group-hover:scale-110 transition-transform"
              />
            </a>
          </div>
        </div>
      </section>

      <!-- Navigation Links - Mobile: Compact Grid, Desktop: Grid -->
      <section
        class="lg:col-span-7 mt-0 sm:mt-0"
      >
        <!-- Mobile: Compact 2-column grid with icons -->
        <nav class="sm:hidden">
          <ul class="grid grid-cols-2 gap-2">
            <li>
              <a
                href={createUrl('about')}
                class="flex items-center justify-center gap-1.5 text-sm text-accent-green hover:text-accent-green/80 active:text-accent-green transition-colors duration-200 min-h-[44px] font-medium"
                style="font-family: var(--font-body);"
              >
                <Icon name="mdi:information" class="w-4 h-4 flex-shrink-0" />
                <span>About</span>
              </a>
            </li>
            <li>
              <a
                href={createUrl('services')}
                class="flex items-center justify-center gap-1.5 text-sm text-accent-green hover:text-accent-green/80 active:text-accent-green transition-colors duration-200 min-h-[44px] font-medium"
                style="font-family: var(--font-body);"
              >
                <Icon name="mdi:briefcase" class="w-4 h-4 flex-shrink-0" />
                <span>Services</span>
              </a>
            </li>
            <li>
              <a
                href={createUrl('blog')}
                class="flex items-center justify-center gap-1.5 text-sm text-accent-green hover:text-accent-green/80 active:text-accent-green transition-colors duration-200 min-h-[44px] font-medium"
                style="font-family: var(--font-body);"
              >
                <Icon name="mdi:book-open" class="w-4 h-4 flex-shrink-0" />
                <span>Blog</span>
              </a>
            </li>
            <li>
              <a
                href={createUrl('faq')}
                class="flex items-center justify-center gap-1.5 text-sm text-accent-green hover:text-accent-green/80 active:text-accent-green transition-colors duration-200 min-h-[44px] font-medium"
                style="font-family: var(--font-body);"
              >
                <Icon name="mdi:help-circle" class="w-4 h-4 flex-shrink-0" />
                <span>FAQ</span>
              </a>
            </li>
          </ul>
        </nav>

        <!-- Desktop: Grid layout with section headers -->
        <div class="hidden sm:grid sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
          <!-- Learn Section -->
          <div class="space-y-3 sm:space-y-4">
            <h4
              class="text-sm font-extrabold tracking-wide text-primary uppercase transition-colors flex items-center gap-2 mb-4"
              style="font-family: var(--font-display);"
            >
              <Icon name="mdi:book-open" class="w-5 h-5 text-accent-green" />
              Learn
            </h4>
            <nav>
              <ul class="space-y-2 sm:space-y-2.5">
                <li>
                  <a
                    href={createUrl('about')}
                    class="text-sm sm:text-base text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[44px] active:text-accent-green font-medium"
                    style="font-family: var(--font-body);"
                  >
                    <span>About Us</span>
                    <Icon
                      name="mdi:arrow-right"
                      class="w-4 h-4 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                    />
                  </a>
                </li>
                <li>
                  <a
                    href={createUrl('services')}
                    class="text-sm sm:text-base text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[44px] active:text-accent-green font-medium"
                    style="font-family: var(--font-body);"
                  >
                    <span>Services</span>
                    <Icon
                      name="mdi:arrow-right"
                      class="w-4 h-4 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                    />
                  </a>
                </li>
                <li>
                  <a
                    href={createUrl('case-studies')}
                    class="text-sm sm:text-base text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[44px] active:text-accent-green font-medium"
                    style="font-family: var(--font-body);"
                  >
                    <span>Case Studies</span>
                    <Icon
                      name="mdi:arrow-right"
                      class="w-4 h-4 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                    />
                  </a>
                </li>
                <li>
                  <a
                    href={createUrl('blog')}
                    class="text-sm sm:text-base text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[44px] active:text-accent-green font-medium"
                    style="font-family: var(--font-body);"
                  >
                    <span>Blog</span>
                    <Icon
                      name="mdi:arrow-right"
                      class="w-4 h-4 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                    />
                  </a>
                </li>
              </ul>
            </nav>
          </div>

          <!-- Engage Section -->
          <div class="space-y-3 sm:space-y-4">
            <h4
              class="text-sm font-extrabold tracking-wide text-primary uppercase transition-colors flex items-center gap-2 mb-4"
              style="font-family: var(--font-display);"
            >
              <Icon name="mdi:handshake" class="w-5 h-5 text-accent-green" />
              Engage
            </h4>
            <ul class="space-y-2 sm:space-y-2.5">
              <li>
                <a
                  href={createUrl('contact')}
                  class="text-sm sm:text-base text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[44px] active:text-accent-green font-medium"
                  style="font-family: var(--font-body);"
                >
                  <span>Contact Us</span>
                  <Icon
                    name="mdi:arrow-right"
                    class="w-4 h-4 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                  />
                </a>
              </li>
              <li>
                <a
                  href={createUrl('tools/maturity-calculator')}
                  class="text-sm sm:text-base text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[44px] active:text-accent-green font-medium"
                  style="font-family: var(--font-body);"
                >
                  <span>Maturity Calculator</span>
                  <Icon
                    name="mdi:arrow-right"
                    class="w-4 h-4 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                  />
                </a>
              </li>
              <li>
                <a
                  href={createUrl('faq')}
                  class="text-sm sm:text-base text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[44px] active:text-accent-green font-medium"
                  style="font-family: var(--font-body);"
                >
                  <span>FAQ</span>
                  <Icon
                    name="mdi:arrow-right"
                    class="w-4 h-4 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                  />
                </a>
              </li>
            </ul>
          </div>

          <!-- Legal Section -->
          <div class="space-y-3 sm:space-y-4">
            <h4
              class="text-sm font-extrabold tracking-wide text-primary uppercase transition-colors flex items-center gap-2 mb-4"
              style="font-family: var(--font-display);"
            >
              <Icon name="mdi:shield-check" class="w-5 h-5 text-accent-green" />
              Legal
            </h4>
            <ul class="space-y-2 sm:space-y-2.5">
              {
                legalLinks.map((link) => (
                  <li>
                    <a
                    href={link.href}
                    class="text-sm sm:text-base text-secondary hover:text-accent-green transition-colors duration-200 min-h-[44px] inline-flex items-center active:text-accent-green font-medium"
                    style="font-family: var(--font-body);"
                  >
                    {link.label}
                  </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>
      </section>

      <!-- Newsletter (if enabled) - Hidden on mobile, shown on desktop -->
      {!hideNewsletter && (
        <section class="hidden sm:block lg:col-span-12 mt-6 lg:mt-8">
          <div
            class="bg-card/50 border border-accent-green/20 rounded-xl p-6 sm:p-8"
          >
            <div class="max-w-2xl mx-auto text-center">
              <h4
                class="text-lg sm:text-xl font-bold text-primary transition-colors mb-3"
                style="font-family: var(--font-display);"
              >
                Get monthly insights on data analytics
              </h4>
              <p class="text-sm text-secondary mb-4 transition-colors" style="font-family: var(--font-body);">
                Join executives who want to stay ahead. Practical insights, industry trends, and actionable strategies—no fluff.
              </p>
            
            <!-- Newsletter Form -->
            <form id="newsletter-form" class="max-w-md mx-auto">
              <div class="flex flex-col sm:flex-row gap-3 mb-3">
                <input
                  type="email"
                  id="newsletter-email"
                  placeholder="Enter your work email"
                  required
                  class="flex-1 px-4 py-3 bg-surface border border-theme rounded-lg focus:outline-none focus:border-accent-green focus:ring-2 focus:ring-accent-green/30 transition-colors text-primary placeholder:text-secondary min-h-[44px]"
                  aria-label="Email address for newsletter subscription"
                  style="font-family: var(--font-body);"
                />
                <button
                  type="submit"
                  class="px-6 py-3 bg-accent-green text-on-accent font-semibold rounded-lg hover:bg-accent-green/90 active:bg-accent-green/80 transition-colors duration-200 whitespace-nowrap min-h-[44px] min-w-[120px]"
                  aria-label="Subscribe to newsletter"
                  style="font-family: var(--font-body);"
                >
                  Subscribe
                </button>
              </div>
              <label
                class="flex items-start gap-2 cursor-pointer group text-left max-w-md mx-auto mb-2"
              >
                <input
                  type="checkbox"
                  id="newsletter-consent"
                  required
                  class="mt-0.5 w-4 h-4 text-accent-green bg-card border-theme rounded focus:ring-accent-green/50 focus:ring-2 transition-colors flex-shrink-0"
                  aria-label="I consent to receive marketing emails"
                />
                <span
                  class="text-xs text-secondary leading-tight transition-colors"
                  style="font-family: var(--font-body);"
                >
                  I consent to receive monthly insights from AUXO Data Labs.
                  <a
                    href={createUrl('legal/privacy-policy')}
                    class="text-accent-green hover:underline transition-colors"
                    >Privacy Policy</a
                  >
                </span>
              </label>
              <p class="text-xs text-secondary mt-2 transition-colors" style="font-family: var(--font-body);">
                Monthly insights. No spam. Unsubscribe anytime.
              </p>
              <p
                id="newsletter-message"
                class="text-sm mt-2 hidden transition-colors"
                style="font-family: var(--font-body);"
              >
              </p>
            </form>
          </div>
        </div>
      </section>
      )}
    </div>
  </div>

  <!-- Footer Bottom - Mobile: Simplified, Desktop: Full -->
  <!-- Mobile: No border-top, reduced spacing -->
  <div
    class="pt-1 sm:border-t sm:border-theme sm:pt-5 mt-1 sm:mt-6 pb-4 sm:pb-8 text-secondary text-xs font-medium transition-colors max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"
  >
    <!-- Mobile: Privacy, PDPL Compliant, Copyright - all centered with reduced spacing -->
    <div class="flex flex-col items-center gap-1 sm:hidden">
      <a
        href={createUrl('legal/privacy-policy')}
        class="text-xs text-accent-green hover:underline transition-colors text-center"
        aria-label="Privacy Policy"
        style="font-family: var(--font-body);"
      >
        Privacy
      </a>
      <a
        href={createUrl('legal/privacy-policy')}
        class="flex items-center gap-1.5 text-xs text-accent-green hover:underline transition-colors text-center"
        aria-label="PDPL Compliant"
        style="font-family: var(--font-body);"
      >
        <Icon
          name="mdi:shield-check"
          class="w-3.5 h-3.5 text-accent-green flex-shrink-0"
        />
        <span>PDPL Compliant</span>
      </a>
      <p class="text-center text-xs" style="font-family: var(--font-body);">
        © {currentYear} AUXO
      </p>
    </div>

    <!-- Desktop: Full layout - Centered -->
    <div
      class="hidden sm:flex sm:flex-row items-center justify-center gap-3 sm:gap-4 lg:gap-5 flex-wrap"
    >
      <!-- Copyright -->
      <p class="text-center" style="font-family: var(--font-body);">
        © {currentYear} AUXO Data Labs. All rights reserved.
      </p>

      <!-- Separator -->
      <span class="text-tertiary" aria-hidden="true">•</span>

      <!-- Location -->
      <span class="flex items-center gap-2 whitespace-nowrap" style="font-family: var(--font-body);">
        <Icon
          name="mdi:map-marker"
          class="w-4 h-4 text-accent-green flex-shrink-0 transition-colors"
        />
        <span>Dubai, UAE</span>
      </span>

      <!-- Separator -->
      <span class="text-tertiary" aria-hidden="true">•</span>

      <!-- PDPL Compliance Badge -->
      <a
        href={createUrl('legal/privacy-policy')}
        class="flex items-center gap-2 whitespace-nowrap px-3 py-1.5 bg-accent-green/10 border border-accent-green rounded-lg hover:bg-accent-green/20 transition-all duration-200 group min-h-[44px]"
        aria-label="View Privacy Policy - PDPL Compliant"
        style="font-family: var(--font-body);"
      >
        <Icon
          name="mdi:shield-check"
          class="w-4 h-4 text-accent-green flex-shrink-0 transition-colors group-hover:scale-110"
        />
        <span class="text-xs font-semibold text-accent-green">PDPL Compliant</span>
      </a>
    </div>
  </div>
</footer>

<script define:vars={{ base }}>
  (function initNewsletterForm() {
    const newsletterForm = document.getElementById("newsletter-form");
    if (!newsletterForm) return;

    const newsletterEmail = document.getElementById("newsletter-email");
    const newsletterMessage = document.getElementById("newsletter-message");
    const consentCheckbox = document.getElementById("newsletter-consent");
    const submitBtn = newsletterForm.querySelector('button[type="submit"]');

    const showMessage = (text, isError = false) => {
      if (!newsletterMessage) return;
      newsletterMessage.textContent = text;
      newsletterMessage.className = `text-xs mt-2 ${isError ? "text-red-400" : "text-accent-green"}`;
      newsletterMessage.classList.remove("hidden");
      if (!isError) {
        setTimeout(() => {
          newsletterMessage?.classList.add("hidden");
        }, 8000);
      }
    };

    const handleNewsletterSubmit = async (e) => {
      e.preventDefault();

      if (!newsletterEmail || !newsletterMessage || !consentCheckbox) return;

      const email = newsletterEmail.value.trim();

      if (!consentCheckbox.checked) {
        showMessage("Please consent to receive our newsletter", true);
        return;
      }

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showMessage(
          "Please enter a valid email address (e.g., name@company.com)",
          true,
        );
        return;
      }

      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Subscribing...";
      }

      try {
        const apiUrl = `${base}api/newsletter`;
        const response = await fetch(apiUrl,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email,
              consent: consentCheckbox.checked,
              timestamp: new Date().toISOString(),
            }),
          },
        );

        const data = await response.json();

        if (!response.ok) {
          showMessage(
            data.error ||
              "We couldn't complete your subscription. Please try again.",
            true,
          );
          return;
        }

        showMessage(
          data.message ||
            "Thank you! Please check your email to confirm your subscription.",
          false,
        );
        newsletterEmail.value = "";
        consentCheckbox.checked = false;
      } catch (error) {
        if (import.meta.env.DEV) {
          console.error("Newsletter subscription error:", error);
        }
        showMessage(
          "Oops! Something went wrong. Please try again in a moment.",
          true,
        );
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = "Subscribe";
        }
      }
    };

    newsletterForm.addEventListener("submit", handleNewsletterSubmit);

    document.addEventListener("astro:before-swap", () => {
      newsletterForm.removeEventListener("submit", handleNewsletterSubmit);
    });
  })();
</script>
