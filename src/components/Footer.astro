---
import { siteData } from "../data/config/site";
import { Icon } from "astro-icon/components";

const base = import.meta.env.BASE_URL;
const currentYear = new Date().getFullYear();

const quickLinks = [
  { href: base, label: "Home" },
  { href: `${base}about/`, label: "About" },
  { href: `${base}services/`, label: "Services" },
  { href: `${base}case-studies/`, label: "Case Studies" },
  { href: `${base}blog/`, label: "Blog" },
  { href: `${base}contact/`, label: "Contact" },
];

const resourceLinks = [
  {
    href: `${base}tools/maturity-calculator/`,
    label: "Maturity Calculator",
    icon: "mdi:calculator",
  },
  { href: `${base}faq/`, label: "FAQ", icon: "mdi:help-circle" },
];

const legalLinks = [
  { href: `${base}legal/privacy-policy/`, label: "Privacy Policy" },
  { href: `${base}legal/terms/`, label: "Terms of Service" },
  { href: `${base}legal/cookie-policy/`, label: "Cookie Policy" },
];
---

<footer
  class="bg-card border-t border-theme relative z-10 transition-colors duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 lg:py-8">
    <!-- Main Footer Content -->
    <div class="grid gap-6 lg:gap-8 lg:grid-cols-12 mb-6 lg:mb-6">
      <!-- Brand Section -->
      <section class="lg:col-span-5 space-y-3">
        <div class="flex items-center gap-3 group">
          <div class="relative">
            <img
              src={`${base}logo.svg`}
              alt="AUXO Data Labs Logo"
              class="h-10 w-10 sm:h-12 sm:w-12 transition-transform duration-300 group-hover:scale-110"
            />
            <div
              class="absolute inset-0 bg-accent-green/20 rounded-full blur-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"
            >
            </div>
          </div>
          <div class="flex flex-col">
            <span
              class="text-primary text-lg sm:text-xl font-bold tracking-tight transition-colors"
            >
              AUXO Data Labs
            </span>
            <span
              class="text-secondary text-xs font-medium tracking-wider uppercase transition-colors"
            >
              Look Beyond Data
            </span>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="space-y-1.5 text-sm">
          <a
            href={`mailto:${siteData.email}`}
            class="flex items-center gap-3 text-secondary hover:text-accent-green transition-colors duration-200 group"
          >
            <div
              class="w-9 h-9 bg-surface rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-accent-green/10 transition-colors"
            >
              <Icon name="mdi:email" class="w-4 h-4 text-accent-green" />
            </div>
            <span class="break-all">{siteData.email}</span>
          </a>
          {
            siteData.phone && (
              <a
                href={`tel:${siteData.phone}`}
                class="flex items-center gap-3 text-secondary hover:text-accent-green transition-colors duration-200 group"
              >
                <div class="w-9 h-9 bg-surface rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-accent-green/10 transition-colors">
                  <Icon name="mdi:phone" class="w-4 h-4 text-accent-green" />
                </div>
                <span>{siteData.phone}</span>
              </a>
            )
          }
          <div class="flex items-center gap-3 text-secondary">
            <div
              class="w-9 h-9 bg-surface rounded-lg flex items-center justify-center flex-shrink-0"
            >
              <Icon name="mdi:map-marker" class="w-4 h-4 text-accent-green" />
            </div>
            <span>
              {siteData.address.city}, {siteData.address.country}
            </span>
          </div>
        </div>

        <!-- Social Links -->
        <div class="flex gap-3">
          <a
            href={siteData.social.linkedin}
            class="w-10 h-10 bg-surface border border-theme rounded-lg flex items-center justify-center hover:bg-accent-green/10 hover:border-accent-green/30 text-secondary hover:text-accent-green transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent-green/50 min-w-[44px] min-h-[44px] group"
            aria-label="Follow AUXO Data Labs on LinkedIn"
            target="_blank"
            rel="noopener noreferrer"
          >
            <Icon
              name="mdi:linkedin"
              class="w-5 h-5 group-hover:scale-110 transition-transform"
            />
          </a>
          <a
            href={siteData.social.twitter}
            class="w-10 h-10 bg-surface border border-theme rounded-lg flex items-center justify-center hover:bg-accent-green/10 hover:border-accent-green/30 text-secondary hover:text-accent-green transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent-green/50 min-w-[44px] min-h-[44px] group"
            aria-label="Follow AUXO Data Labs on Twitter"
            target="_blank"
            rel="noopener noreferrer"
          >
            <Icon
              name="mdi:twitter"
              class="w-5 h-5 group-hover:scale-110 transition-transform"
            />
          </a>
        </div>
      </section>

      <!-- Navigation Links -->
      <section
        class="lg:col-span-7 grid grid-cols-2 sm:grid-cols-2 gap-6 sm:gap-6"
      >
        <!-- Quick Links -->
        <div class="space-y-4">
          <h4
            class="text-xs font-bold tracking-wide text-primary uppercase transition-colors"
          >
            Navigation
          </h4>
          <nav>
            <ul class="space-y-2">
              {
                quickLinks.map((link) => (
                  <li>
                    <a
                      href={link.href}
                      class="text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[32px]"
                    >
                      <span>{link.label}</span>
                      <Icon
                        name="mdi:arrow-right"
                        class="w-3 h-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                      />
                    </a>
                  </li>
                ))
              }
            </ul>
          </nav>
        </div>

        <!-- Resources -->
        <div class="space-y-4">
          <h4
            class="text-xs font-bold tracking-wide text-primary uppercase transition-colors"
          >
            Resources
          </h4>
          <ul class="space-y-2">
            {
              resourceLinks.map((link) => (
                <li>
                  <a
                    href={link.href}
                    class="text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-2 group min-h-[32px]"
                  >
                    <Icon
                      name={link.icon}
                      class="w-4 h-4 text-accent-green/70 group-hover:text-accent-green transition-colors flex-shrink-0"
                    />
                    <span>{link.label}</span>
                  </a>
                </li>
              ))
            }
          </ul>

          <!-- Legal Links -->
          <div class="pt-3 border-t border-theme">
            <h4
              class="text-xs font-bold tracking-wide text-primary uppercase transition-colors mb-4"
            >
              Legal
            </h4>
            <ul class="space-y-2">
              {
                legalLinks.map((link) => (
                  <li>
                    <a
                      href={link.href}
                      class="text-sm text-secondary hover:text-accent-green transition-colors duration-200 min-h-[32px] inline-flex items-center"
                    >
                      {link.label}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>
      </section>

      <!-- Startup Promise Section -->
      <section
        class="lg:col-span-12 mt-6 lg:mt-8 pt-6 lg:pt-8 border-t border-theme"
      >
        <div
          class="bg-accent-green/10 border border-accent-green/30 rounded-xl p-6 sm:p-8"
        >
          <h4
            class="text-sm font-bold tracking-wide text-primary uppercase mb-4 transition-colors"
          >
            What to Expect When Working With Us
          </h4>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="flex items-center gap-3">
              <Icon
                name="mdi:account-group"
                class="w-5 h-5 text-accent-green flex-shrink-0"
              />
              <span class="text-sm text-secondary transition-colors"
                >Direct access to founders</span
              >
            </div>
            <div class="flex items-center gap-3">
              <Icon
                name="mdi:clock"
                class="w-5 h-5 text-accent-green flex-shrink-0"
              />
              <span class="text-sm text-secondary transition-colors"
                >Fast response times (24 hours)</span
              >
            </div>
            <div class="flex items-center gap-3">
              <Icon
                name="mdi:calendar-check"
                class="w-5 h-5 text-accent-green flex-shrink-0"
              />
              <span class="text-sm text-secondary transition-colors"
                >No long-term contracts</span
              >
            </div>
            <div class="flex items-center gap-3">
              <Icon
                name="mdi:eye"
                class="w-5 h-5 text-accent-green flex-shrink-0"
              />
              <span class="text-sm text-secondary transition-colors"
                >Transparent pricing</span
              >
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Footer Bottom -->
  <div
    class="border-t border-theme pt-4 sm:pt-5 mt-4 sm:mt-6 text-secondary text-xs font-medium transition-colors max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"
  >
    <div
      class="flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4"
    >
      <!-- Copyright -->
      <p class="text-center sm:text-left order-2 sm:order-1">
        © {currentYear} AUXO Data Labs. All rights reserved.
      </p>

      <!-- Location and Compliance Info -->
      <div
        class="flex flex-col sm:flex-row items-center justify-center sm:justify-end gap-3 sm:gap-5 lg:gap-6 order-1 sm:order-2"
      >
        <!-- Location -->
        <span class="flex items-center gap-2 whitespace-nowrap">
          <Icon
            name="mdi:map-marker"
            class="w-4 h-4 text-accent-green flex-shrink-0 transition-colors"
          />
          <span>Dubai, UAE</span>
        </span>

        <!-- Separator (hidden on mobile, visible on tablet+) -->
        <span class="hidden sm:inline text-tertiary" aria-hidden="true">•</span>

        <!-- PDPL Compliance -->
        <span class="flex items-center gap-2 whitespace-nowrap">
          <Icon
            name="mdi:shield-check"
            class="w-4 h-4 text-accent-green flex-shrink-0 transition-colors"
          />
          <span>PDPL Compliant</span>
        </span>
      </div>
    </div>
  </div>
</footer>

<script>
  // Optimized newsletter form handler with better error handling
  (function initNewsletterForm() {
    const newsletterForm = document.getElementById("newsletter-form");
    if (!newsletterForm) return;

    const newsletterEmail = document.getElementById(
      "newsletter-email",
    ) as HTMLInputElement | null;
    const newsletterMessage = document.getElementById("newsletter-message");
    const consentCheckbox = document.getElementById(
      "newsletter-consent",
    ) as HTMLInputElement | null;
    const submitBtn = newsletterForm.querySelector(
      'button[type="submit"]',
    ) as HTMLButtonElement | null;

    const showMessage = (text: string, isError = false) => {
      if (!newsletterMessage) return;
      newsletterMessage.textContent = text;
      newsletterMessage.className = `text-xs mt-2 ${isError ? "text-red-400" : "text-accent-green"}`;
      newsletterMessage.classList.remove("hidden");
      if (!isError) {
        setTimeout(() => {
          newsletterMessage?.classList.add("hidden");
        }, 8000);
      }
    };

    const handleNewsletterSubmit = async (e: Event) => {
      e.preventDefault();

      if (!newsletterEmail || !newsletterMessage || !consentCheckbox) return;

      const email = newsletterEmail.value.trim();

      // Validate consent
      if (!consentCheckbox.checked) {
        showMessage("Please consent to receive marketing emails", true);
        return;
      }

      // Validate email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showMessage("Please enter a valid email address", true);
        return;
      }

      // Disable submit button
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Subscribing...";
      }

      try {
        const response = await fetch(
          `${import.meta.env.BASE_URL}api/newsletter`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email,
              consent: consentCheckbox.checked,
              timestamp: new Date().toISOString(),
            }),
          },
        );

        const data = await response.json();

        if (!response.ok) {
          showMessage(
            data.error || "Subscription failed. Please try again.",
            true,
          );
          return;
        }

        showMessage(
          data.message ||
            "Thank you! Please check your email to confirm your subscription.",
          false,
        );
        newsletterEmail.value = "";
        consentCheckbox.checked = false;
      } catch (error) {
        if (import.meta.env.DEV) {
          console.error("Newsletter subscription error:", error);
        }
        showMessage("An error occurred. Please try again later.", true);
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = "Subscribe";
        }
      }
    };

    newsletterForm.addEventListener("submit", handleNewsletterSubmit);

    // Cleanup on Astro view transitions
    document.addEventListener("astro:before-swap", () => {
      newsletterForm.removeEventListener("submit", handleNewsletterSubmit);
    });
  })();
</script>
