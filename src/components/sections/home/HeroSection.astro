---
// Third-party
import { Icon } from "astro-icon/components";

// Internal Components
import Button from "../../ui/Button.astro";

// Data
import {
  homepageContent,
  type HomepageContent,
} from "../../../data/content/homepage";

// Utils
import { createUrl } from "../../../utils/url";

const content: HomepageContent["hero"] = homepageContent.hero;
---

<section
  id="hero"
  class="relative h-screen flex flex-col items-center justify-center overflow-hidden pt-0 pb-6 sm:pb-8"
>
  <!-- Hero Content Container -->
  <div
    class="container mx-auto responsive-padding relative z-content flex-1 flex flex-col items-center justify-center"
  >
    <div class="w-full max-w-6xl mx-auto text-center">
      <!-- New in Dubai Badge with Typing Animation -->
      {
        content.badge && (
          <div class="mb-4 sm:mb-6 animate-fade-in -mt-4 sm:-mt-6">
            <div class="typing-badge typing-enhanced">
              <span
                id="typing-text"
                class="text-xs sm:text-sm font-bold text-accent-green tracking-wider uppercase"
                style="font-family: var(--font-body);"
              />
            </div>
          </div>
        )
      }

      <!-- Logo Animation Container -->
      <div class="mb-6 sm:mb-8">
        <div class="logo-grid w-36 md:w-48 lg:w-56 mx-auto">
          <div class="logo-tile">
            <span class="logo-char">A</span>
          </div>
          <div class="logo-tile">
            <span class="logo-char">U</span>
          </div>
          <div class="logo-tile">
            <span class="logo-char">X</span>
          </div>
          <div class="logo-tile">
            <span class="logo-char">O</span>
          </div>
        </div>
      </div>

      <!-- Brand Text -->
      <div class="logo-caption mb-4 sm:mb-6">
        <h1
          class="text-2xl md:text-3xl lg:text-4xl xl:text-5xl font-extrabold mb-2 text-primary tracking-tight transition-colors"
          style="font-family: var(--font-display);"
        >
          Data Labs
        </h1>
        <p
          class="tagline text-base md:text-lg lg:text-xl text-accent-green font-semibold italic transition-colors"
          style="font-family: var(--font-display);"
        >
          Look Beyond Data
        </p>
      </div>

      <!-- Main Headline -->
      <div class="hero-headline mb-5 sm:mb-6">
        <h2
          class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold leading-tight text-primary transition-colors mb-2"
          style="font-family: var(--font-display);"
        >
          <span class="block">{content.title}</span>
          <span class="block text-accent-green mt-1"
            >{content.titleHighlight}</span
          >
        </h2>
      </div>

      <!-- CTA Buttons -->
      <div
        class="hero-cta mb-4 sm:mb-6 animate-fade-in"
        style="animation-delay: 0.8s;"
      >
        <div
          class="flex flex-col sm:flex-row items-center justify-center gap-3 sm:gap-4"
        >
          {
            content.primaryCta.text && (
              <Button
                variant="primary"
                size="md"
                href={createUrl(content.primaryCta.href)}
                class="w-full sm:w-auto font-bold shadow-lg shadow-accent-green/20"
              >
                {content.primaryCta.text}
                <Icon name="mdi:arrow-right" class="w-5 h-5" />
              </Button>
            )
          }
          {
            content.secondaryCta.text && (
              <Button
                variant="outline"
                size="md"
                href={createUrl(content.secondaryCta.href)}
                class="w-full sm:w-auto font-bold"
              >
                {content.secondaryCta.text}
                <Icon name="mdi:chart-line" class="w-5 h-5" />
              </Button>
            )
          }
        </div>
      </div>

      <!-- Scroll Indicator -->
      <div
        class="relative z-content flex flex-col items-center animate-fade-in mt-8 sm:mt-12"
        style="animation-delay: 1.2s;"
      >
        <a
          href="#services"
          class="flex flex-col items-center text-secondary hover:text-accent-green transition-colors group"
          aria-label={content.scrollIndicator}
        >
          <span
            class="text-xs mb-1 font-medium uppercase tracking-wider"
            style="font-family: var(--font-body);"
            >{content.scrollIndicator}</span
          >
          <div class="animate-bounce">
            <Icon
              name="mdi:chevron-down"
              class="w-4 h-4 group-hover:scale-110 transition-transform"
            />
          </div>
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  // Typing animation for "HELLO WORLD!" badge with looping support
  let typingAnimationTimer: ReturnType<typeof setTimeout> | null = null;
  let typingCharIndex = 0;
  let typingIsDeleting = false;

  const badgeText = "HELLO WORLD!";

  function initTypingAnimation() {
    // Clear any existing animation
    if (typingAnimationTimer) {
      clearTimeout(typingAnimationTimer);
      typingAnimationTimer = null;
    }

    const typingText = document.getElementById("typing-text");
    if (!typingText) return;

    const text = badgeText;
    typingCharIndex = 0;
    typingIsDeleting = false;
    const typingSpeed = 100; // ms per character

    function type() {
      const currentTypingText = document.getElementById("typing-text");
      if (!currentTypingText) return;

      const currentText = text.substring(0, typingCharIndex);
      currentTypingText.textContent = currentText;

      if (!typingIsDeleting && typingCharIndex < text.length) {
        typingCharIndex++;
        typingAnimationTimer = setTimeout(type, typingSpeed);
      } else if (typingIsDeleting && typingCharIndex > 0) {
        typingCharIndex--;
        typingAnimationTimer = setTimeout(type, typingSpeed / 2);
      } else if (typingCharIndex === text.length) {
        // Wait before deleting
        typingAnimationTimer = setTimeout(() => {
          typingIsDeleting = true;
          type();
        }, 2000);
      } else if (typingCharIndex === 0 && typingIsDeleting) {
        // Wait before typing again (loop)
        typingIsDeleting = false;
        typingAnimationTimer = setTimeout(type, 500);
      }
    }

    // Start typing after a short delay
    typingAnimationTimer = setTimeout(type, 500);
  }

  // Logo animation reset and re-trigger
  function initLogoAnimation() {
    const logoTiles = document.querySelectorAll(".logo-tile");
    if (!logoTiles.length) return;

    // Reset animation by removing and re-adding the animation property
    logoTiles.forEach((tile, index) => {
      const tileEl = tile as HTMLElement;

      // Reset to initial animation state
      tileEl.style.opacity = "0";
      tileEl.style.transform = "scale(0) rotate(-180deg)";
      tileEl.style.animation = "none";

      // Force reflow
      void tileEl.offsetWidth;

      // Re-enable animation with proper delay
      tileEl.style.animation = "";
      tileEl.style.opacity = "";
      tileEl.style.transform = "";

      // Re-apply animation delay via style if needed
      if (index > 0) {
        tileEl.style.animationDelay = `${index * 0.1}s`;
      }
    });

    // Also reset logo caption and headline animations
    const logoCaption = document.querySelector(".logo-caption") as HTMLElement;
    if (logoCaption) {
      logoCaption.style.opacity = "0";
      logoCaption.style.transform = "translateY(20px)";
      logoCaption.style.animation = "none";
      void logoCaption.offsetWidth;
      logoCaption.style.animation = "";
      logoCaption.style.opacity = "";
      logoCaption.style.transform = "";
    }

    const heroHeadline = document.querySelector(
      ".hero-headline",
    ) as HTMLElement;
    if (heroHeadline) {
      heroHeadline.style.opacity = "0";
      heroHeadline.style.transform = "translateY(30px)";
      heroHeadline.style.animation = "none";
      void heroHeadline.offsetWidth;
      heroHeadline.style.animation = "";
      heroHeadline.style.opacity = "";
      heroHeadline.style.transform = "";
    }
  }

  // Initialize animations on page load
  function setupHeroAnimations() {
    // Check if we're on the home page
    const heroSection = document.getElementById("hero");
    if (!heroSection) return;

    initLogoAnimation();
    initTypingAnimation();
  }

  // Run on initial load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupHeroAnimations);
  } else {
    setupHeroAnimations();
  }

  // Re-initialize on Astro view transitions
  document.addEventListener("astro:page-load", () => {
    // Small delay to ensure DOM is ready
    setTimeout(() => {
      setupHeroAnimations();
    }, 50);
  });

  // Cleanup on page swap
  document.addEventListener("astro:before-swap", () => {
    if (typingAnimationTimer) {
      clearTimeout(typingAnimationTimer);
      typingAnimationTimer = null;
    }
  });
</script>
