---
import { siteData } from "../data/config/site";
import { Icon } from "astro-icon/components";

interface Props {
  hideNewsletter?: boolean;
}

const { hideNewsletter = false } = Astro.props;
const base = import.meta.env.BASE_URL;
const currentYear = new Date().getFullYear();

const quickLinks = [
  { href: base, label: "Home" },
  { href: `${base}about/`, label: "About" },
  { href: `${base}services/`, label: "Services" },
  { href: `${base}case-studies/`, label: "Case Studies" },
  { href: `${base}blog/`, label: "Blog" },
  { href: `${base}contact/`, label: "Contact" },
];

const resourceLinks = [
  {
    href: `${base}tools/maturity-calculator/`,
    label: "Maturity Calculator",
    icon: "mdi:calculator",
  },
  { href: `${base}faq/`, label: "FAQ", icon: "mdi:help-circle" },
];

const legalLinks = [
  { href: `${base}legal/privacy-policy/`, label: "Privacy Policy" },
  { href: `${base}legal/terms/`, label: "Terms of Service" },
  { href: `${base}legal/cookie-policy/`, label: "Cookie Policy" },
];
---

<footer
  class="bg-card border-t border-theme relative z-10 transition-colors duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 md:py-8">
    <!-- Main Footer Content -->
    <div class="grid gap-4 sm:gap-6 lg:gap-8 lg:grid-cols-12 mb-4 sm:mb-6 lg:mb-6">
      <!-- Brand Section -->
      <section class="lg:col-span-5 space-y-2 sm:space-y-3">
        <div class="flex items-center gap-3 group">
          <div class="relative">
            <img
              src={`${base}logo.svg`}
              alt="AUXO Data Labs Logo"
              class="h-10 w-10 sm:h-12 sm:w-12 transition-transform duration-300 group-hover:scale-110"
            />
            <div
              class="absolute inset-0 bg-accent-green/20 rounded-full blur-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"
            >
            </div>
          </div>
          <div class="flex flex-col">
            <span
              class="text-primary text-lg sm:text-xl font-bold tracking-tight transition-colors"
            >
              AUXO Data Labs
            </span>
            <span
              class="text-secondary text-xs font-medium tracking-wider uppercase transition-colors"
            >
              Look Beyond Data
            </span>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="space-y-2 sm:space-y-3 text-xs sm:text-sm">
          <div class="space-y-1.5 sm:space-y-2">
            <a
              href={`mailto:${siteData.email}`}
              class="flex items-center gap-3 text-secondary hover:text-accent-green transition-colors duration-200 group"
            >
              <div
                class="w-9 h-9 bg-surface rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-accent-green/10 transition-colors"
              >
                <Icon name="mdi:email" class="w-4 h-4 text-accent-green" />
              </div>
              <span class="break-all">{siteData.email}</span>
            </a>
            <!-- Email Action Button -->
            <a
              href={`mailto:${siteData.email}?subject=Inquiry from AUXO Website`}
              class="inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-accent-green/10 hover:bg-accent-green/20 border border-accent-green/30 rounded-lg text-xs font-semibold text-accent-green transition-all duration-200 min-h-[44px] group active:bg-accent-green/30"
            >
              <Icon name="mdi:email-outline" class="w-4 h-4 group-hover:scale-110 transition-transform" />
              <span>Email Now</span>
            </a>
          </div>
          {
            siteData.phone && (
              <div class="space-y-2">
                <a
                  href={`tel:${siteData.phone}`}
                  class="flex items-center gap-3 text-secondary hover:text-accent-green transition-colors duration-200 group"
                >
                  <div class="w-9 h-9 bg-surface rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-accent-green/10 transition-colors">
                    <Icon name="mdi:phone" class="w-4 h-4 text-accent-green" />
                  </div>
                  <span>{siteData.phone}</span>
                </a>
                <!-- Phone Action Button -->
                <a
                  href={`tel:${siteData.phone}`}
                  class="inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-accent-green/10 hover:bg-accent-green/20 border border-accent-green/30 rounded-lg text-xs font-semibold text-accent-green transition-all duration-200 min-h-[44px] group active:bg-accent-green/30"
                >
                  <Icon name="mdi:phone" class="w-4 h-4 group-hover:scale-110 transition-transform" />
                  <span>Call Now</span>
                </a>
              </div>
            )
          }
          <div class="space-y-1.5 sm:space-y-2">
            <div class="flex items-center gap-2 sm:gap-3 text-secondary">
              <div
                class="w-8 h-8 sm:w-9 sm:h-9 bg-surface rounded-lg flex items-center justify-center flex-shrink-0"
              >
                <Icon name="mdi:map-marker" class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-accent-green" />
              </div>
              <span class="text-xs sm:text-sm">
                {siteData.address.city}, {siteData.address.country}
              </span>
            </div>
            <!-- Response Time Guarantee -->
            <div class="flex items-center gap-1.5 sm:gap-2 px-2.5 sm:px-3 py-1.5 sm:py-2 bg-accent-green/10 border border-accent-green/30 rounded-lg">
              <Icon name="mdi:clock" class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-accent-green flex-shrink-0" />
              <span class="text-xs text-secondary transition-colors">
                We respond within <span class="font-semibold text-accent-green">24 hours</span>
              </span>
            </div>
          </div>
        </div>

        <!-- Social Links -->
        <div class="flex gap-2 sm:gap-3">
          <a
            href={siteData.social.linkedin}
            class="w-10 h-10 bg-surface border border-theme rounded-lg flex items-center justify-center hover:bg-accent-green/10 hover:border-accent-green/30 text-secondary hover:text-accent-green transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent-green/50 min-w-[44px] min-h-[44px] group active:bg-accent-green/20"
            aria-label="Follow AUXO Data Labs on LinkedIn"
            target="_blank"
            rel="noopener noreferrer"
          >
            <Icon
              name="mdi:linkedin"
              class="w-5 h-5 group-hover:scale-110 transition-transform"
            />
          </a>
          <a
            href={siteData.social.twitter}
            class="w-10 h-10 bg-surface border border-theme rounded-lg flex items-center justify-center hover:bg-accent-green/10 hover:border-accent-green/30 text-secondary hover:text-accent-green transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-accent-green/50 min-w-[44px] min-h-[44px] group active:bg-accent-green/20"
            aria-label="Follow AUXO Data Labs on Twitter"
            target="_blank"
            rel="noopener noreferrer"
          >
            <Icon
              name="mdi:twitter"
              class="w-5 h-5 group-hover:scale-110 transition-transform"
            />
          </a>
        </div>
      </section>

      <!-- Navigation Links -->
      <section
        class="lg:col-span-7 grid grid-cols-2 sm:grid-cols-3 gap-4 sm:gap-6"
      >
        <!-- Learn Section -->
        <div class="space-y-2 sm:space-y-4">
          <h4
            class="text-xs font-bold tracking-wide text-primary uppercase transition-colors flex items-center gap-1.5 sm:gap-2"
          >
            <Icon name="mdi:book-open" class="w-4 h-4 text-accent-green" />
            Learn
          </h4>
          <nav>
            <ul class="space-y-1.5 sm:space-y-2">
              <li>
                <a
                  href={`${base}about/`}
                  class="text-xs sm:text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-1.5 sm:gap-2 group min-h-[44px] active:text-accent-green"
                >
                  <span>About Us</span>
                  <Icon
                    name="mdi:arrow-right"
                    class="w-3 h-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                  />
                </a>
              </li>
              <li>
                <a
                  href={`${base}services/`}
                  class="text-xs sm:text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-1.5 sm:gap-2 group min-h-[44px] active:text-accent-green"
                >
                  <span>Services</span>
                  <Icon
                    name="mdi:arrow-right"
                    class="w-3 h-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                  />
                </a>
              </li>
              <li>
                <a
                  href={`${base}case-studies/`}
                  class="text-xs sm:text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-1.5 sm:gap-2 group min-h-[44px] active:text-accent-green"
                >
                  <span>Case Studies</span>
                  <Icon
                    name="mdi:arrow-right"
                    class="w-3 h-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                  />
                </a>
              </li>
              <li>
                <a
                  href={`${base}blog/`}
                  class="text-xs sm:text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-1.5 sm:gap-2 group min-h-[44px] active:text-accent-green"
                >
                  <span>Blog</span>
                  <Icon
                    name="mdi:arrow-right"
                    class="w-3 h-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200"
                  />
                </a>
              </li>
            </ul>
          </nav>
        </div>

        <!-- Engage Section -->
        <div class="space-y-2 sm:space-y-4">
          <h4
            class="text-xs font-bold tracking-wide text-primary uppercase transition-colors flex items-center gap-1.5 sm:gap-2"
          >
            <Icon name="mdi:handshake" class="w-4 h-4 text-accent-green" />
            Engage
          </h4>
          <ul class="space-y-1.5 sm:space-y-2">
            <li>
              <a
                href={`${base}contact/`}
                class="text-xs sm:text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-1.5 sm:gap-2 group min-h-[44px] active:text-accent-green"
              >
                <Icon
                  name="mdi:message"
                  class="w-4 h-4 text-accent-green/70 group-hover:text-accent-green transition-colors flex-shrink-0"
                />
                <span>Contact Us</span>
              </a>
            </li>
            <li>
              <a
                href={`${base}tools/maturity-calculator/`}
                class="text-xs sm:text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-1.5 sm:gap-2 group min-h-[44px] active:text-accent-green"
              >
                <Icon
                  name="mdi:calculator"
                  class="w-4 h-4 text-accent-green/70 group-hover:text-accent-green transition-colors flex-shrink-0"
                />
                <span>Maturity Calculator</span>
              </a>
            </li>
            <li>
              <a
                href={`${base}faq/`}
                class="text-xs sm:text-sm text-secondary hover:text-accent-green transition-colors duration-200 inline-flex items-center gap-1.5 sm:gap-2 group min-h-[44px] active:text-accent-green"
              >
                <Icon
                  name="mdi:help-circle"
                  class="w-4 h-4 text-accent-green/70 group-hover:text-accent-green transition-colors flex-shrink-0"
                />
                <span>FAQ</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Legal Section -->
        <div class="space-y-2 sm:space-y-4">
          <h4
            class="text-xs font-bold tracking-wide text-primary uppercase transition-colors flex items-center gap-1.5 sm:gap-2"
          >
            <Icon name="mdi:shield-check" class="w-4 h-4 text-accent-green" />
            Legal
          </h4>
          <ul class="space-y-1.5 sm:space-y-2">
            {
              legalLinks.map((link) => (
                <li>
                  <a
                    href={link.href}
                    class="text-xs sm:text-sm text-secondary hover:text-accent-green transition-colors duration-200 min-h-[44px] inline-flex items-center active:text-accent-green"
                  >
                    {link.label}
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </section>

      <!-- Founder Contact Section -->
      <section class="lg:col-span-12 mt-6 lg:mt-0">
        <div
          class="bg-gradient-to-r from-accent-green/10 to-accent-green/20 border border-accent-green/30 rounded-xl p-6 sm:p-8"
        >
          <h4
            class="text-sm font-bold tracking-wide text-primary uppercase mb-3 transition-colors"
          >
            Questions? Reach out directly
          </h4>
          <p class="text-sm text-secondary mb-4 transition-colors">
            Talk directly with founders. No account managers. No sales pitches.
          </p>
          <a
            href={`mailto:${siteData.email}`}
            class="inline-flex items-center gap-2 px-6 py-3 bg-accent-green text-on-accent rounded-lg hover:bg-accent-green/90 active:bg-accent-green/80 transition-all duration-200 font-semibold text-sm min-h-[44px] min-w-[44px] group"
          >
            <Icon
              name="mdi:email"
              class="w-5 h-5 group-hover:scale-110 transition-transform"
            />
            <span>{siteData.email}</span>
          </a>
        </div>
      </section>

      <!-- Newsletter Signup Section -->
      {!hideNewsletter && (
        <section class="lg:col-span-12 mt-6 lg:mt-8">
          <div
            class="bg-card/50 border border-accent-green/20 rounded-xl p-6 sm:p-8"
          >
            <div class="max-w-2xl mx-auto text-center">
              <div class="flex items-center justify-center gap-3 mb-3">
                <h4
                  class="text-lg sm:text-xl font-bold text-primary transition-colors"
                >
                  Get monthly insights on data analytics, delivered to your inbox
                </h4>
              <!-- Frequency Badge -->
              <span class="inline-flex items-center gap-1.5 px-3 py-1 bg-accent-green/10 border border-accent-green/30 rounded-full text-xs font-semibold text-accent-green whitespace-nowrap">
                <Icon name="mdi:calendar-check" class="w-3.5 h-3.5" />
                Monthly
              </span>
            </div>
            <p class="text-sm text-secondary mb-4 transition-colors">
              Join executives who want to stay ahead of the curve. Get practical
              insights, industry trends, and actionable strategies—no fluff.
            </p>
            
            <!-- Recent Newsletter Preview -->
            <div class="bg-surface/50 border border-theme rounded-lg p-4 mb-6 max-w-xl mx-auto text-left">
              <p class="text-xs font-semibold mb-2 text-primary uppercase tracking-wide transition-colors">
                Recent Topics
              </p>
              <div class="flex flex-wrap gap-2">
                <span class="px-2.5 py-1 bg-card border border-theme rounded-md text-xs text-secondary transition-colors">
                  Data Maturity Models
                </span>
                <span class="px-2.5 py-1 bg-card border border-theme rounded-md text-xs text-secondary transition-colors">
                  ROI Frameworks
                </span>
                <span class="px-2.5 py-1 bg-card border border-theme rounded-md text-xs text-secondary transition-colors">
                  Analytics Best Practices
                </span>
                <span class="px-2.5 py-1 bg-card border border-theme rounded-md text-xs text-secondary transition-colors">
                  Startup Case Studies
                </span>
              </div>
            </div>

            <!-- Value Proposition Cards -->
            <div
              class="bg-card/50 border border-accent-green/20 rounded-lg p-6 mb-6 max-w-xl mx-auto text-left"
            >
              <p
                class="text-sm font-semibold mb-3 text-primary transition-colors"
              >
                What you'll receive:
              </p>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div class="flex items-start gap-2">
                  <Icon
                    name="mdi:check"
                    class="w-5 h-5 text-accent-green flex-shrink-0 mt-0.5"
                  />
                  <span class="text-sm text-secondary transition-colors"
                    >Industry trends and insights</span
                  >
                </div>
                <div class="flex items-start gap-2">
                  <Icon
                    name="mdi:check"
                    class="w-5 h-5 text-accent-green flex-shrink-0 mt-0.5"
                  />
                  <span class="text-sm text-secondary transition-colors"
                    >ROI frameworks and practical tips</span
                  >
                </div>
                <div class="flex items-start gap-2">
                  <Icon
                    name="mdi:check"
                    class="w-5 h-5 text-accent-green flex-shrink-0 mt-0.5"
                  />
                  <span class="text-sm text-secondary transition-colors"
                    >Data analytics best practices</span
                  >
                </div>
                <div class="flex items-start gap-2">
                  <Icon
                    name="mdi:check"
                    class="w-5 h-5 text-accent-green flex-shrink-0 mt-0.5"
                  />
                  <span class="text-sm text-secondary transition-colors"
                    >Exclusive content and resources</span
                  >
                </div>
              </div>
            </div>

            <!-- Newsletter Form -->
            <form id="newsletter-form" class="max-w-md mx-auto">
              <div class="flex flex-col sm:flex-row gap-3 mb-3">
                <input
                  type="email"
                  id="newsletter-email"
                  placeholder="Enter your work email"
                  required
                  class="flex-1 px-4 py-3 bg-surface border border-theme rounded-lg focus:outline-none focus:border-accent-green focus:ring-2 focus:ring-accent-green/30 transition-colors text-primary placeholder:text-secondary min-h-[44px]"
                  aria-label="Email address for newsletter subscription"
                />
                <button
                  type="submit"
                  class="px-6 py-3 bg-accent-green text-on-accent font-semibold rounded-lg hover:bg-accent-green/90 active:bg-accent-green/80 transition-all duration-200 whitespace-nowrap min-h-[44px] min-w-[120px]"
                  aria-label="Subscribe to newsletter"
                >
                  Subscribe
                </button>
              </div>
              <label
                class="flex items-start gap-2 cursor-pointer group text-left max-w-md mx-auto mb-2"
              >
                <input
                  type="checkbox"
                  id="newsletter-consent"
                  required
                  class="mt-0.5 w-4 h-4 text-accent-green bg-card border-theme rounded focus:ring-accent-green/50 focus:ring-2 transition-colors flex-shrink-0"
                  aria-label="I consent to receive marketing emails"
                />
                <span
                  class="text-xs text-secondary leading-tight group-hover:text-primary transition-colors"
                >
                  I consent to receive monthly insights from AUXO Data Labs.
                  <a
                    href={`${base}legal/privacy-policy/`}
                    class="text-accent-green hover:underline transition-colors"
                    >Privacy Policy</a
                  >
                </span>
              </label>
              <p class="text-xs text-secondary mt-2 transition-colors">
                Monthly insights. No spam. Unsubscribe anytime.
              </p>
              <p
                id="newsletter-message"
                class="text-sm mt-2 hidden transition-colors"
              >
              </p>
            </form>
          </div>
        </div>
      </section>
      )}

    </div>
  </div>

  <!-- Footer Bottom -->
  <div
    class="border-t border-theme pt-4 sm:pt-5 mt-4 sm:mt-6 text-secondary text-xs font-medium transition-colors max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"
  >
    <div
      class="flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4"
    >
      <!-- Copyright -->
      <p class="text-center sm:text-left order-2 sm:order-1">
        © {currentYear} AUXO Data Labs. All rights reserved.
      </p>

      <!-- Location and Compliance Info -->
      <div
        class="flex flex-col sm:flex-row items-center justify-center sm:justify-end gap-3 sm:gap-5 lg:gap-6 order-1 sm:order-2"
      >
        <!-- Location -->
        <span class="flex items-center gap-2 whitespace-nowrap">
          <Icon
            name="mdi:map-marker"
            class="w-4 h-4 text-accent-green flex-shrink-0 transition-colors"
          />
          <span>Dubai, UAE</span>
        </span>

        <!-- Separator (hidden on mobile, visible on tablet+) -->
        <span class="hidden sm:inline text-tertiary" aria-hidden="true">•</span>

        <!-- PDPL Compliance Badge -->
        <a
          href={`${base}legal/privacy-policy/`}
          class="flex items-center gap-2 whitespace-nowrap px-3 py-1.5 bg-accent-green/10 border border-accent-green/30 rounded-lg hover:bg-accent-green/20 transition-all duration-200 group"
          aria-label="View Privacy Policy - PDPL Compliant"
        >
          <Icon
            name="mdi:shield-check"
            class="w-4 h-4 text-accent-green flex-shrink-0 transition-colors group-hover:scale-110"
          />
          <span class="text-xs font-semibold text-accent-green">PDPL Compliant</span>
        </a>
      </div>
    </div>
  </div>
</footer>

<script>
  // Optimized newsletter form handler with better error handling
  (function initNewsletterForm() {
    const newsletterForm = document.getElementById("newsletter-form");
    if (!newsletterForm) return;

    const newsletterEmail = document.getElementById(
      "newsletter-email",
    ) as HTMLInputElement | null;
    const newsletterMessage = document.getElementById("newsletter-message");
    const consentCheckbox = document.getElementById(
      "newsletter-consent",
    ) as HTMLInputElement | null;
    const submitBtn = newsletterForm.querySelector(
      'button[type="submit"]',
    ) as HTMLButtonElement | null;

    const showMessage = (text: string, isError = false) => {
      if (!newsletterMessage) return;
      newsletterMessage.textContent = text;
      newsletterMessage.className = `text-xs mt-2 ${isError ? "text-red-400" : "text-accent-green"}`;
      newsletterMessage.classList.remove("hidden");
      if (!isError) {
        setTimeout(() => {
          newsletterMessage?.classList.add("hidden");
        }, 8000);
      }
    };

    const handleNewsletterSubmit = async (e: Event) => {
      e.preventDefault();

      if (!newsletterEmail || !newsletterMessage || !consentCheckbox) return;

      const email = newsletterEmail.value.trim();

      // Validate consent
      if (!consentCheckbox.checked) {
        showMessage("Please consent to receive our newsletter", true);
        return;
      }

      // Validate email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showMessage(
          "Please enter a valid email address (e.g., name@company.com)",
          true,
        );
        return;
      }

      // Disable submit button
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Subscribing...";
      }

      try {
        const response = await fetch(
          `${import.meta.env.BASE_URL}api/newsletter`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email,
              consent: consentCheckbox.checked,
              timestamp: new Date().toISOString(),
            }),
          },
        );

        const data = await response.json();

        if (!response.ok) {
          showMessage(
            data.error ||
              "We couldn't complete your subscription. Please try again.",
            true,
          );
          return;
        }

        showMessage(
          data.message ||
            "Thank you! Please check your email to confirm your subscription. We'll send you monthly insights on data analytics.",
          false,
        );
        newsletterEmail.value = "";
        consentCheckbox.checked = false;
      } catch (error) {
        if (import.meta.env.DEV) {
          console.error("Newsletter subscription error:", error);
        }
        showMessage(
          "Oops! Something went wrong. Please try again in a moment.",
          true,
        );
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = "Subscribe";
        }
      }
    };

    newsletterForm.addEventListener("submit", handleNewsletterSubmit);

    // Cleanup on Astro view transitions
    document.addEventListener("astro:before-swap", () => {
      newsletterForm.removeEventListener("submit", handleNewsletterSubmit);
    });
  })();
</script>
